icon: redirects-icon
label: redirects.app.label
appClass: info.magnolia.ui.framework.app.BaseApp
class: info.magnolia.ui.contentapp.configuration.ContentAppDescriptor

datasource: &datasource
  $type: jcrDatasource
  workspace: redirects
  allowedNodeTypes:
    - mgnl:redirect
    - mgnl:folder

subApps:
  browser:
    class: info.magnolia.ui.contentapp.configuration.BrowserDescriptor
    actions:
      addRedirect:
        icon: icon-add-item
        $type: openDetailSubappAction
        appName: redirects
        subAppName: detail
        viewType: add
        availability:
          writePermissionRequired: true
          root: true
      editRedirect:
        icon: icon-edit
        $type: openDetailSubappAction
        appName: redirects
        subAppName: detail
        viewType: edit
      deleteRedirect:
        icon: icon-delete
        $type: deleteNodesConfirmationAction
      addFolder:
        icon: icon-add-folder
        $type: addNodeAction
        nodeType: mgnl:folder
        availability:
          writePermissionRequired: true
    actionbar:
      defaultAction: editRedirect
      sections:
        - name: redirect
          availability:
            nodeTypes:
              - mgnl:redirect
          groups:
            - name: editActions
              items:
                - name: editRedirect
                - name: deleteRedirect
        - name: folder
          availability:
            nodeTypes:
              - mgnl:folder
          groups:
            - name: addActions
              items:
                - name: addRedirect
                - name: addFolder
            - name: editActions
              items:
                - name: deleteRedirect
        - name: root
          availability:
            root: true
          groups:
            - name: addActions
              items:
                - name: addRedirect
                - name: addFolder
    workbench:
      contentViews:
        - name: tree
          $type: treeView
          columns:
            - name: jcrName
              $type: jcrTitleColumn
              propertyName: fromUrl
              nodeTypeToIcon:
                mgnl:redirect: icon-forward
                mgnl:folder: icon-folder-l
            - name: site
              $type: propertyColumn
              width: 100
            - name: toUrl
              $type: propertyColumn
              width: 300
            - name: mgnl:lastModified
              $type: dateColumn
              width: 160

  detail:
    class: info.magnolia.ui.contentapp.detail.DetailDescriptor
    itemProvider:
      $type: jcrNodeFromLocationProvider
      workspace: redirects
      nodeType: mgnl:redirect
    datasource:
      <<: *datasource
      describeByProperty: fromUrl
    actions:
      commit:
        $type: commitAction
      cancel:
        $type: closeAction
    form:
      properties:
        - name: fromUrl
          $type: textField
          label: From URL
          required: true
          description: The URL path to redirect from (must start with /)
        - name: site
          $type: textField
          label: Site
          defaultValue: fallback
          required: true
          description: Site name (use 'fallback' for all sites)
        - name: toUrl
          $type: textField
          label: To URL
          required: true
          description: The destination URL
        - name: toUrlSuffix
          $type: textField
          label: URL Suffix
        - name: redirectType
          $type: radioButtonGroupField
          label: Redirect Type
          defaultValue: "301"
          datasource:
            $type: optionListDatasource
            options:
              - name: "301"
                value: "301"
                label: 301 Permanent
              - name: "302"
                value: "302"
                label: 302 Temporary
        - name: usePattern
          $type: checkBoxField
          label: Use Pattern
          description: Enable pattern matching for dynamic redirects
          defaultValue: false
        - name: description
          $type: textField
          label: Description
          rows: 3

permissions:
  roles:
    canAccessRedirectsApp: canAccessRedirectsApp
